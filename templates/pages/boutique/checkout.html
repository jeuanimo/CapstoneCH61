{% extends 'base.html' %}
{% load static %}
{% load math_filters %}

{% block content %}
<div class="container mt-4">
    <h1 style="color: #1a1a2e; margin-bottom: 30px;">Checkout</h1>

    <div class="row">
        <!-- Checkout Form -->
        <div class="col-md-8">
            <div class="card" style="border: 1px solid #dee2e6;">
                <div class="card-body">
                    <h5 class="card-title" style="color: #1a1a2e; margin-bottom: 25px;">Shipping Information</h5>

                    <form method="POST">
                        {% csrf_token %}

                        <!-- Email -->
                        <div class="mb-3">
                            <label for="{{ form.email.id_for_label }}" class="form-label" style="color: #1a1a2e; font-weight: 500;">Email Address</label>
                            {{ form.email }}
                            {% if form.email.errors %}
                            <div class="form-text" style="color: #dc3545;">
                                {% for error in form.email.errors %}{{ error }}{% endfor %}
                            </div>
                            {% endif %}
                        </div>

                        <!-- Address -->
                        <div class="mb-3">
                            <label for="{{ form.address.id_for_label }}" class="form-label" style="color: #1a1a2e; font-weight: 500;">Street Address</label>
                            {{ form.address }}
                            {% if form.address.errors %}
                            <div class="form-text" style="color: #dc3545;">
                                {% for error in form.address.errors %}{{ error }}{% endfor %}
                            </div>
                            {% endif %}
                        </div>

                        <!-- City & State -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.city.id_for_label }}" class="form-label" style="color: #1a1a2e; font-weight: 500;">City</label>
                                {{ form.city }}
                                {% if form.city.errors %}
                                <div class="form-text" style="color: #dc3545;">
                                    {% for error in form.city.errors %}{{ error }}{% endfor %}
                                </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.state.id_for_label }}" class="form-label" style="color: #1a1a2e; font-weight: 500;">State</label>
                                {{ form.state }}
                                {% if form.state.errors %}
                                <div class="form-text" style="color: #dc3545;">
                                    {% for error in form.state.errors %}{{ error }}{% endfor %}
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- ZIP Code -->
                        <div class="mb-3">
                            <label for="{{ form.zip_code.id_for_label }}" class="form-label" style="color: #1a1a2e; font-weight: 500;">ZIP Code</label>
                            {{ form.zip_code }}
                            {% if form.zip_code.errors %}
                            <div class="form-text" style="color: #dc3545;">
                                {% for error in form.zip_code.errors %}{{ error }}{% endfor %}
                            </div>
                            {% endif %}
                        </div>

                        <hr style="margin: 30px 0;">

                        <div style="display: flex; gap: 15px;">
                            <button type="submit" class="btn btn-dark" style="flex: 1; background-color: #1a1a2e; border-color: #1a1a2e; padding: 12px; font-weight: 500;">
                                Continue to Payment
                            </button>
                            <a href="{% url 'view_cart' %}" class="btn btn-outline-dark" style="flex: 1; border-color: #1a1a2e; color: #1a1a2e; padding: 12px; text-decoration: none; text-align: center;">
                                Back to Cart
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Order Summary -->
        <div class="col-md-4">
            <div class="card" style="border: 1px solid #dee2e6; position: sticky; top: 20px;">
                <div class="card-body">
                    <h5 class="card-title" style="color: #1a1a2e; margin-bottom: 20px;">Order Summary</h5>

                    <!-- Cart Items -->
                    <div style="max-height: 300px; overflow-y: auto; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #dee2e6;">
                        {% for item in cart.cartitem_set.all %}
                        <div style="display: flex; justify-content: space-between; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #f0f0f0;">
                            <div>
                                <p style="margin: 0; color: #1a1a2e; font-weight: 500;">{{ item.product.name }}</p>
                                <p style="margin: 5px 0 0 0; color: #6c757d; font-size: 0.9em;">Qty: {{ item.quantity }}</p>
                            </div>
                            <p style="margin: 0; color: #1a1a2e; font-weight: 500;">${{ item.product.price|mul:item.quantity }}</p>
                        </div>
                        {% endfor %}
                    </div>

                    <!-- Totals -->
                    <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #dee2e6;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="color: #6c757d;">Subtotal:</span>
                            <span style="color: #1a1a2e; font-weight: 500;">${{ cart.get_total_price }}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="color: #6c757d;">Shipping:</span>
                            <span style="color: #1a1a2e; font-weight: 500;">Calculated at next step</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #6c757d;">Tax:</span>
                            <span style="color: #1a1a2e; font-weight: 500;">Calculated at next step</span>
                        </div>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center; font-size: 1.1em;">
                        <span style="color: #1a1a2e; font-weight: bold;">Total:</span>
                        <span style="color: #1a1a2e; font-weight: bold;">${{ cart.get_total_price }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .form-control, .form-label {
        color: #333;
    }

    .form-control:focus {
        border-color: #1a1a2e;
        box-shadow: 0 0 0 0.2rem rgba(26, 26, 46, 0.25);
    }

    @media (max-width: 768px) {
        .col-md-4 {
            margin-top: 30px;
        }
    }
</style>
{% endblock %}
