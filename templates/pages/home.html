{% extends "base.html" %}

{% load static %}

{% block title %}Home - Phi Beta Sigma Fraternity, Inc. | Nu Gamma Sigma Chapter{% endblock %}

{% block css %}
<style>
    html {
        height: 100%;
        width: 100%;
        margin: 0;
        padding: 0;
    }
    
    body {
        height: 100%;
        width: 100%;
        margin: 0;
        padding: 0;
        background-color: var(--background-light);
        display: flex;
        flex-direction: column;
    }
    
    body > .top-bar {
        flex-shrink: 0;
    }
    
    body > .navbar {
        flex-shrink: 0;
    }
    
    body > .portal-navbar {
        flex-shrink: 0;
    }
    
    body > .home-container {
        flex: 1;
        min-height: 0;
    }
    
    body.dark-mode {
        background-color: #0b1020;
    }
    
    .home-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        background-image: linear-gradient(rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.9)), url('{% static 'img/ngs.jpg' %}');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        background-attachment: scroll;
        box-sizing: border-box;
    }
    
    body.dark-mode .home-container {
        background-image: linear-gradient(rgba(11, 16, 32, 0.95), rgba(11, 16, 32, 0.95)), url('{% static 'img/ngs.jpg' %}');
    }
    
    .home-cards {
        display: grid;
        grid-template-columns: 15% 65% 20%;
        grid-template-rows: 1fr 1fr;
        gap: 0.75rem;
        width: 100%;
        max-width: 1200px;
        height: 100%;
        padding: 0.5rem;
    }
    
    /* International HQ - top left */
    .home-card:nth-child(1) {
        grid-column: 1;
        grid-row: 1;
    }
    
    /* Our Chapter - middle, spans both rows */
    .home-card:nth-child(2) {
        grid-column: 2;
        grid-row: 1 / 3;
    }
    
    /* Calendar - bottom left */
    .home-card:nth-child(3) {
        grid-column: 1;
        grid-row: 2;
    }
    
    /* Chatbot - right side, spans both rows */
    .home-card:nth-child(4) {
        grid-column: 3;
        grid-row: 1 / 3;
        display: flex;
        flex-direction: column;
    }
    
    .home-card {
        background: var(--bg-secondary);
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15), 0 0 15px rgba(255, 255, 255, 0.8);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        display: flex;
        flex-direction: column;
        height: 100%;
    }
    
    body.dark-mode .home-card {
        background: #1a2a4a;
    }
    
    .home-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.25), 0 0 25px rgba(255, 255, 255, 1);
    }
    
    .card-btn {
        background-color: var(--primary-color);
        color: #ffffff !important;
        border: none;
        padding: 0.4rem 0.6rem;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.2s ease;
        margin-top: 0.5rem;
        text-decoration: none;
        display: inline-block;
        white-space: nowrap;
    }
    
    .card-btn:hover {
        background-color: var(--secondary-color);
        color: var(--primary-color) !important;
        transform: scale(1.05);
        text-decoration: none;
    }
    
    .btn-group {
        display: flex;
        gap: 0.75rem;
        justify-content: space-between;
        width: 100%;
        margin-top: 0.5rem;
        flex-wrap: wrap;
    }
    
    .btn-group .card-btn {
        flex: 1;
        min-width: 80px;
        margin: 0.25rem;
    }
    
    .card-image {
        width: 100%;
        height: 50%;
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: rgba(255, 255, 255, 0.3);
        flex-shrink: 0;
        position: relative;
        overflow: hidden;
    }
    
    .card-image img {
        max-width: 85%;
        max-height: 85%;
        object-fit: contain;
    }
    
    .card-content {
        padding: 0.75rem;
        text-align: center;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 50%;
        gap: 0.25rem;
        background-color: #c8c9c7;
        color: #164f90;
    }
    
    .card-title {
        font-size: 1rem;
        font-weight: 700;
        color: #164f90 !important;
        margin: 0;
    }
    
    /* ========================================
       CAROUSEL STYLES FOR "OUR CHAPTER" CARD
       ======================================== */
    
    /* Custom JavaScript Carousel Styles */
    .chapter-carousel-container {
        position: relative;
        width: 100%;
        height: 100%;
        background: #f5f5f5;        border-radius: 8px 8px 0 0;
        overflow: hidden;    }
    
    body.dark-mode .chapter-carousel-container {
        background: #2a3a5a;
    }
    
    .chapter-carousel-wrapper {
        position: relative;
        width: 100%;
        height: 100%;
        overflow: hidden;
        border-radius: 8px 8px 0 0;
    }
    
    .chapter-carousel-slide {
        position: absolute;
        width: 100%;
        height: 100%;
        opacity: 0;
        transition: opacity 0.6s ease-in-out;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .chapter-carousel-slide.active {
        opacity: 1;
        position: relative;
    }
    
    .chapter-carousel-slide img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        width: auto;
        height: auto;
    }
    
    .chapter-carousel-prev,
    .chapter-carousel-next {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(22, 79, 144, 0.6);
        color: white;
        border: none;
        width: 36px;
        height: 36px;
        font-size: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
        z-index: 10;
        transition: background 0.3s ease;
    }
    
    .chapter-carousel-prev:hover,
    .chapter-carousel-next:hover {
        background: rgba(22, 79, 144, 0.9);
    }
    
    .chapter-carousel-prev {
        left: 10px;
    }
    
    .chapter-carousel-next {
        right: 10px;
    }
    
    body.dark-mode .chapter-carousel-prev,
    body.dark-mode .chapter-carousel-next {
        background: rgba(135, 206, 235, 0.4);
    }
    
    body.dark-mode .chapter-carousel-prev:hover,
    body.dark-mode .chapter-carousel-next:hover {
        background: rgba(135, 206, 235, 0.8);
    }
    
    .chapter-carousel-controls {
        position: absolute;
        bottom: 15px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 10;
        display: flex;
        gap: 8px;
    }
    
    .chapter-carousel-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: rgba(22, 79, 144, 0.5);
        border: none;
        cursor: pointer;
        transition: background 0.3s ease;
    }
    
    .chapter-carousel-dot.active {
        background: #164f90;
    }
    
    body.dark-mode .chapter-carousel-dot {
        background: rgba(135, 206, 235, 0.4);
    }
    
    body.dark-mode .chapter-carousel-dot.active {
        background: #87ceeb;
    }
    
    @media (max-width: 768px) {
        .home-cards {
            grid-template-columns: 1fr;
        }
        
        .chapter-carousel-prev,
        .chapter-carousel-next {
            width: 28px;
            height: 28px;
            font-size: 16px;
        }
        
        .chapter-carousel-controls {
            bottom: 10px;
        }
        
        .chapter-carousel-dot {
            width: 6px;
            height: 6px;
        }
    }
    
    /* Modal Styles */
    .modal {
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    .modal.show {
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .modal-content {
        background-color: #ffffff;
        padding: 2rem;
        border-radius: 8px;
        max-width: 700px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        position: relative;
        animation: slideDown 0.3s ease;
    }
    
    @keyframes slideDown {
        from {
            transform: translateY(-50px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }
    
    body.dark-mode .modal-content {
        background-color: #1a2a4a;
        color: #e8edf7;
    }
    
    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        border-bottom: 2px solid #164f90;
        padding-bottom: 1rem;
    }
    
    body.dark-mode .modal-header {
        border-bottom-color: #87ceeb;
    }
    
    .modal-header h2 {
        margin: 0;
        color: #164f90;
        font-size: 1.8rem;
    }
    
    body.dark-mode .modal-header h2 {
        color: #87ceeb;
    }
    
    .modal-close {
        background-color: #164f90;
        color: #ffffff;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 600;
        transition: background-color 0.3s ease;
    }
    
    .modal-close:hover {
        background-color: #c8c9c7;
        color: #164f90;
    }
    
    .modal-body {
        font-size: 1rem;
        line-height: 1.8;
        color: #333;
    }
    
    body.dark-mode .modal-body {
        color: #e8edf7;
    }
    
    .modal-body h3 {
        color: #164f90;
        margin-top: 1.5rem;
        margin-bottom: 0.75rem;
    }
    
    body.dark-mode .modal-body h3 {
        color: #87ceeb;
    }
    
    .modal-body p {
        margin-bottom: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="home-container">
    <div class="home-cards">
        <div class="home-card">
            <div class="card-image">
                <img src="{% static 'img/PBS_Seal_2019_Color.png' %}" alt="Phi Beta Sigma Seal">
            </div>
            <div class="card-content">
                <h3 class="card-title">International Headquarters</h3>
                <div class="btn-group">
                    <button class="card-btn" data-popup-url="https://phibetasigma1914.org/about-history/">History</button>
                    <button class="card-btn" data-popup-url="https://phibetasigma1914.org/leadership/presidents-message/">Leadership</button>
                    <button class="card-btn" data-popup-url="https://phibetasigma1914.org/about/sigma-membership/">Membership</button>
                </div>
            </div>
        </div>
        
        <!-- Our Chapter Card with Photo Carousel at Top -->
        <!-- Custom JavaScript carousel displays photos uploaded by officers -->
        <div class="home-card">
            <!-- Card Image Section: Contains the custom photo carousel -->
            <div class="card-image">
                <!-- Custom Photo Carousel: Displays recent photos uploaded by officers -->
                <div class="chapter-carousel-container">
                    <div class="chapter-carousel-wrapper">
                        {% if carousel_photos %}
                            {% for slide_item in carousel_photos %}
                                <div class="chapter-carousel-slide {% if forloop.first %}active{% endif %}">
                                    <img src="{{ slide_item.image.url }}" alt="Chapter slide: {{ slide_item.caption|default:'fraternity event' }}">
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="chapter-carousel-slide active">
                                <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #164f90 0%, #1e3a5f 100%); color: white; text-align: center;">
                                    <div>
                                        <i class="fas fa-image" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                                        <p>Chapter photos coming soon!</p>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                        
                        <!-- Carousel Navigation Arrows -->
                        <button class="chapter-carousel-prev" id="chapter-carousel-prev">‚ùÆ</button>
                        <button class="chapter-carousel-next" id="chapter-carousel-next">‚ùØ</button>
                    </div>
                    
                    <!-- Carousel Indicator Dots -->
                    <div class="chapter-carousel-controls">
                        {% if carousel_photos %}
                            {% for photo in carousel_photos %}
                                <button class="chapter-carousel-dot {% if forloop.first %}active{% endif %}" data-dot-index="{{ forloop.counter0 }}"></button>
                            {% endfor %}
                        {% else %}
                            <button class="chapter-carousel-dot active" data-dot-index="0"></button>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Card Content Section: Title and navigation buttons below the carousel -->
            <div class="card-content">
                <h3 class="card-title">Our Chapter</h3>
                <!-- Navigation Buttons: Links to chapter information pages and shop -->
                <div class="btn-group">
                    <button class="card-btn" data-modal-target="historyModal">History</button>
                    <button class="card-btn" data-nav-url="{% url 'chapter_leadership' %}">Leadership</button>
                    <button class="card-btn" data-modal-target="membershipModal">Membership</button>
                    <button class="card-btn" data-nav-url="{% url 'chapter_programs' %}">Programs</button>
                    <button class="card-btn" data-nav-url="{% url 'shop_home' %}">üõçÔ∏è Shop</button>
                </div>
            </div>
        </div>
        
        
        <div class="home-card">
            <div class="card-image">
                <img src="{% static 'img/calendar.png' %}" alt="Calendar of Events">
            </div>
            <div class="card-content">
                <h3 class="card-title">Calendar of Events</h3>
                <div class="btn-group">
                    <button class="card-btn" data-modal-target="calendarModal">View Calendar</button>
                </div>
            </div>
        </div>
        
        <!-- Chatbot Card - Right side -->
        <div class="home-card chatbot-card">
            <div class="card-image">
                <img src="{% static 'img/chatbot_icon.svg' %}" alt="Chat Bot Icon" style="max-width: 70%; max-height: 70%; object-fit: contain;">
            </div>
            
            <div class="card-content">
                <h3 class="card-title">Chat</h3>
                
                <div class="chatbot-container">
                    <div class="chat-messages" id="chat-messages">
                        <div class="chat-message bot-message">
                            <div class="message-content">
                                Hi! Ask about our chapter!
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-input-area">
                        <input 
                            type="text" 
                            id="chat-input" 
                            class="chat-input" 
                            placeholder="Ask..."
                            maxlength="400"
                            aria-label="Chat message input"
                        >
                        <button class="send-btn" id="send-btn" aria-label="Send message">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- History Modal -->
<div id="historyModal" class="modal">
        .chatbot-card {
            display: flex;
            flex-direction: column;
        }
        
        .chatbot-card .card-image {
            height: 30%;
            background: linear-gradient(135deg, #164f90 0%, #c8c9c7 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: rgba(255, 255, 255, 0.6);
            flex-shrink: 0;
        }
        
        .chatbot-card .card-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: #c8c9c7;
            gap: 0;
            padding: 0;
            overflow: hidden;
        }
        
        body.dark-mode .chatbot-card .card-content {
            background-color: rgba(26, 42, 74, 0.95);
        }
        
        .chatbot-card .card-title {
            font-size: 0.85rem;
            margin: 0.4rem 0.4rem 0 0.4rem;
            padding: 0;
        }
        
        .chatbot-card .chatbot-container {
            flex: 1;
            min-height: 0;
            display: flex;
            flex-direction: column;
            border: none;
            border-radius: 0;
        }
        
        .chat-message {
            display: flex;
            margin-bottom: 0.3rem;
            animation: slideIn 0.3s ease;
            flex-shrink: 0;
        }
        
        .chatbot-card .chat-message {
            margin-bottom: 0.2rem;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .bot-message {
            justify-content: flex-start;
        }
        
        .user-message {
            justify-content: flex-end;
        }
        
        .message-content {
            max-width: 100%;
            padding: 0.4rem 0.6rem;
            border-radius: 6px;
            line-height: 1.4;
            font-size: 0.8rem;
            word-break: break-word;
            overflow-wrap: break-word;
            white-space: normal;
        }
        
        .message-content p {
            margin: 0.2rem 0;
            word-break: break-word;
            overflow-wrap: break-word;
        }
        
        .message-content p:first-child {
            margin-top: 0;
        }
        
        .message-content p:last-child {
            margin-bottom: 0;
        }
        
        .chatbot-card .message-content {
            padding: 0.35rem 0.5rem;
            font-size: 0.75rem;
            border-radius: 4px;
            max-width: 95%;
            word-break: break-word;
            overflow-wrap: break-word;
        }
        
        .chatbot-card .message-content p {
            margin: 0.15rem 0;
        }
        
        .bot-message .message-content {
            background: #e3f2fd;
            color: #164f90;
        }
        
        body.dark-mode .bot-message .message-content {
            background: #1a2a4a;
            color: #87ceeb;
        }
        
        .user-message .message-content {
            background: #164f90;
            color: white;
        }
        
        .loading-dots {
            display: flex;
            gap: 0.3rem;
        }
        
        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #164f90;
            animation: bounce 1.4s infinite;
        }
        
        body.dark-mode .dot {
            background: #87ceeb;
        }
        
        .dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes bounce {
            0%, 80%, 100% {
                transform: translateY(0);
                opacity: 0.7;
            }
            40% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }
        
        .chat-input-area {
            border-top: 1px solid #e0e0e0;
            padding: 0.5rem;
            background: #f9f9f9;
            display: flex;
            gap: 0.3rem;
            flex-shrink: 0;
        }
        
        .chatbot-card .chat-input-area {
            padding: 0.4rem;
            gap: 0.2rem;
        }
        
        body.dark-mode .chat-input-area {
            border-top-color: #1a2a4a;
            background: #050810;
        }
        
        .chat-input {
            flex: 1;
            padding: 0.4rem 0.5rem;
            border: 1px solid #c8c9c7;
            border-radius: 3px;
            font-size: 0.75rem;
            font-family: inherit;
            max-height: 100px;
        }
        
        .chatbot-card .chat-input {
            padding: 0.3rem 0.4rem;
            font-size: 0.7rem;
        }
        
        body.dark-mode .chat-input {
            background: #0b1020;
            color: #e8edf7;
            border-color: #2a3a5a;
        }
        
        .chat-input:focus {
            outline: none;
            border-color: #164f90;
            box-shadow: 0 0 0 0.2rem rgba(22, 79, 144, 0.25);
        }
        
        body.dark-mode .chat-input:focus {
            border-color: #87ceeb;
            box-shadow: 0 0 0 0.2rem rgba(135, 206, 235, 0.25);
        }
        
        .send-btn {
            background: #164f90;
            color: white;
            border: none;
            padding: 0.4rem 0.8rem;
            border-radius: 3px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
            white-space: nowrap;
            font-size: 0.75rem;
        }
        
        .chatbot-card .send-btn {
            padding: 0.3rem 0.6rem;
            font-size: 0.7rem;
        }
        
        .send-btn:hover {
            background: #0d3a6b;
            transform: translateY(-2px);
        }
        
        .send-btn:active {
            transform: translateY(0);
        }
        
        .char-counter {
            font-size: 0.8rem;
            color: #999;
            margin-top: 0.25rem;
            text-align: right;
        }
        
        body.dark-mode .char-counter {
            color: #6a7a8a;
        }
        
        .chatbot-card .char-counter {
            display: none;
        }
        
        @media (max-width: 768px) {
            .home-cards {
                grid-template-columns: 1fr;
            }
            
            .home-card:nth-child(2) {
                grid-column: 1;
            }
            
            .home-card:nth-child(3) {
                grid-column: 1;
            }
        }
    </style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const chatInput = document.getElementById('chat-input');
    const sendBtn = document.getElementById('send-btn');
    const messagesContainer = document.getElementById('chat-messages');
    
    // Send message
    function sendMessage() {
        const message = chatInput.value.trim();
        if (!message) return;
        
        // Add user message
        addUserMessage(message);
        chatInput.value = '';
        
        // Disable send button
        sendBtn.disabled = true;
        
        // Show loading animation
        showLoadingMessage();
        
        // Send to chatbot API
        fetch('{% url "chatbot:query" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({ query: message })
        })
        .then(response => response.json())
        .then(data => {
            removeLastMessage();
            if (data.answer) {
                addBotMessage(data.answer);
            } else if (data.suggestions && data.suggestions.length > 0) {
                let suggestionsText = 'Suggestions:\n';
                data.suggestions.forEach(sugg => {
                    suggestionsText += `\n‚Ä¢ ${sugg.question}`;
                });
                addBotMessage(suggestionsText);
            } else {
                addBotMessage('No matches found. Try contacting us.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            removeLastMessage();
            addBotMessage('Error. Try again.');
        })
        .finally(() => {
            sendBtn.disabled = false;
            chatInput.focus();
        });
    }
    
    function addUserMessage(text) {
        const div = document.createElement('div');
        div.className = 'chat-message user-message';
        div.innerHTML = `<div class="message-content">${escapeHtml(text)}</div>`;
        messagesContainer.appendChild(div);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
    
    function addBotMessage(text) {
        const div = document.createElement('div');
        div.className = 'chat-message bot-message';
        const lines = text.split('\n').map(line => `<p style="margin: 0.15rem 0; word-break: break-word;">${escapeHtml(line)}</p>`).join('');
        div.innerHTML = `<div class="message-content">${lines}</div>`;
        messagesContainer.appendChild(div);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
    
    function showLoadingMessage() {
        const div = document.createElement('div');
        div.className = 'chat-message bot-message';
        div.innerHTML = `<div class="message-content"><div class="loading-dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div>`;
        messagesContainer.appendChild(div);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
    
    function removeLastMessage() {
        if (messagesContainer.lastChild) {
            messagesContainer.removeChild(messagesContainer.lastChild);
        }
    }
    
    function escapeHtml(text) {
        const map = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#039;'
        };
        return text.replace(/[&<>"']/g, m => map[m]);
    }
    
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    
    // Event listeners
    if (sendBtn) sendBtn.addEventListener('click', sendMessage);
    if (chatInput) {
        chatInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
    }
});
</script>

<!-- History Modal -->
<div id="historyModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>About The Nu Gamma Sigma Chapter</h2>
            <button class="modal-close" data-modal-close="historyModal">Close</button>
        </div>
        <div class="modal-body">
            <p>The <strong>Nu Gamma Sigma Chapter</strong> of Phi Beta Sigma Fraternity, Inc. proudly serves the Belleville, Illinois area and the surrounding communities throughout St. Clair County and Madison County, Illinois. Chartered on <strong>May 21, 2002</strong>, the chapter was established to extend Sigma's mission beyond the collegiate environment by delivering meaningful service, leadership development, and mentorship throughout the Metro East region.</p>
            
            <h3>Our Mission</h3>
            <p>As an alumni chapter within the <strong>Great Lakes Region</strong>, Nu Gamma Sigma brings together professional men dedicated to advancing the fraternity's guiding principle, <strong>Culture for Service and Service for Humanity</strong>. Although not affiliated with an HBCU campus, the chapter maintains strong partnerships with local organizations, schools, and civic groups to support educational initiatives, youth development, community outreach, and economic empowerment programs.</p>
            
            <h3>Current Leadership</h3>
            <p>Under the leadership of Chapter President <strong>Ronald McClellan</strong>, the chapter continues to strengthen brotherhood while addressing the evolving needs of the communities it serves. The chapter's administrative mailing address is <strong>P.O. Box 23183, Belleville, IL 62223-9294</strong>, and official correspondence may be directed through its established communication channels.</p>
            
            <h3>Our Legacy</h3>
            <p>Since its chartering, Nu Gamma Sigma has remained committed to upholding the legacy of Phi Beta Sigma Fraternity, Inc. through consistent community engagement, regional collaboration, and impactful service programming. Through dedication, unity, and action, the chapter continues to exemplify Sigma excellence across Belleville, St. Clair County, and Madison County.</p>
        </div>
    </div>
</div>

<!-- Leadership Modal -->
<div id="leadershipModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Chapter Leadership</h2>
            <button class="modal-close" data-modal-close="leadershipModal">Close</button>
        </div>
        <div class="modal-body">
            <p>Welcome to the Chapter Leadership section. Learn about the current and past leadership of Nu Gamma Sigma Chapter.</p>
            
            <h3>Current Officers</h3>
            <p>Add information about your current chapter officers and their roles...</p>
            
            <h3>Leadership Structure</h3>
            <p>Describe your chapter's organizational structure and leadership hierarchy...</p>
            
            <h3>Contact Leadership</h3>
            <p>Provide information on how to contact chapter leadership...</p>
        </div>
    </div>
</div>

<!-- Membership Modal -->
<div id="membershipModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Chapter Membership</h2>
            <button class="modal-close" data-modal-close="membershipModal">Close</button>
        </div>
        <div class="modal-body">
            <h3>Basic Eligibility Requirements</h3>
            <p><strong>Membership in Phi Beta Sigma Fraternity, Inc.</strong> is divided into two main categories: <strong>Collegiate</strong> (members currently attending colleges and universities), and <strong>Alumni</strong> (members who have completed their undergraduate education).</p>
            
            <h4 style="color: #164f90; margin-top: 1.5rem;">Collegiate Membership</h4>
            <p>Membership in Phi Beta Sigma Fraternity is limited to college men who are actively working toward obtaining a baccalaureate degree at a recognized college or university. Potential candidates should have:</p>
            <ul style="margin-left: 1.5rem;">
                <li>Completed at least one grading period</li>
                <li>Obtained a minimum of a 2.5 cumulative GPA based on a four-point scale</li>
            </ul>
            
            <h4 style="color: #164f90; margin-top: 1.5rem;">Alumni Membership</h4>
            <p>Membership in Phi Beta Sigma Fraternity is limited to professional men who have earned a baccalaureate degree or other degree from a recognized college or university.</p>
            
            <h4 style="color: #164f90; margin-top: 1.5rem;">General Eligibility Requirements</h4>
            <ul style="margin-left: 1.5rem;">
                <li>Candidates of Phi Beta Sigma Fraternity <strong>cannot hold active or previous membership in another intercollegiate fraternity</strong>, other than an honorary or professional fraternity.</li>
                <li>Candidates for membership in Phi Beta Sigma Fraternity must apply to a chapter in the region where they reside, based upon the terms and conditions outlined in the Fraternity's membership intake and development process.</li>
                <li><strong>Nu Gamma Sigma Chapter is an Alumni Chapter</strong> and expects applicants to meet the requirements for Alumni Status.</li>
            </ul>
            
            <h3 style="margin-top: 2rem; border-top: 1px solid #164f90; padding-top: 1rem;">Ready to Become a Man of Sigma?</h3>
            <p>If you are interested in becoming a man of Sigma and joining Nu Gamma Sigma Chapter, we want to hear from you! Contact us today to learn more about membership opportunities.</p>
            <div style="text-align: center; margin-top: 1.5rem;">
                <a href="{% url 'contact' %}" class="card-btn" style="background-color: #164f90; color: #ffffff; padding: 0.75rem 2rem; font-size: 1rem;">Contact Us</a>
            </div>
        </div>
    </div>
</div>

<!-- Calendar Modal -->
<div id="calendarModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Calendar of Events</h2>
            <button class="modal-close" data-modal-close="calendarModal">Close</button>
        </div>
        <div class="modal-body">
            <div style="margin-bottom: 1.5rem;">
                <form method="GET" action="{% url 'events' %}" style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                    <input type="text" name="title" placeholder="Search events..." aria-label="Search events" style="flex: 1; padding: 0.5rem; border: 1px solid #c8c9c7; border-radius: 4px; font-size: 0.95rem;">
                    <button type="submit" style="padding: 0.5rem 1.5rem; background-color: #164f90; color: #ffffff; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">Search</button>
                    <a href="{% url 'events' %}" style="padding: 0.5rem 1.5rem; background-color: #c8c9c7; color: #164f90; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; text-decoration: none; text-align: center;">View Full Calendar</a>
                </form>
            </div>
            
            <h3>Upcoming Events</h3>
            {% if upcoming_events %}
                <div style="display: grid; gap: 1rem;">
                    {% for event in upcoming_events %}
                        <div style="padding: 1rem; background: #f9f9f9; border-radius: 4px; border-left: 4px solid #164f90;">
                            <p style="font-weight: bold; color: #164f90; margin: 0 0 0.5rem 0;">{{ event.title }}</p>
                            <p style="font-size: 0.9rem; color: #666; margin: 0.25rem 0;">üìÖ {{ event.start_date|date:"M d, Y - g:i A" }}</p>
                            {% if event.location %}
                                <p style="font-size: 0.9rem; color: #666; margin: 0.25rem 0;">üìç {{ event.location }}</p>
                            {% endif %}
                            {% if event.description %}
                                <p style="font-size: 0.9rem; color: #333; margin: 0.5rem 0 0 0; line-height: 1.5;">{{ event.description|truncatewords:30 }}</p>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p style="text-align: center; color: #999; padding: 2rem;">No upcoming events scheduled yet.</p>
            {% endif %}
            
            <div style="text-align: center; margin-top: 1.5rem;">
                <a href="{% url 'events' %}" class="card-btn" style="background-color: #164f90; color: #ffffff; padding: 0.75rem 2rem; font-size: 1rem; display: inline-block;">View Full Calendar</a>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block js %}
<script>
    // Modal functions - Define directly on window object
    window.openModal = function(modalId) {
        console.log('Opening modal:', modalId);
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.add('show');
            document.body.style.overflow = 'hidden';
        } else {
            console.error('Modal not found:', modalId);
        }
    };
    
    window.closeModal = function(modalId) {
        console.log('Closing modal:', modalId);
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.remove('show');
            document.body.style.overflow = 'auto';
        } else {
            console.error('Modal not found:', modalId);
        }
    };
    
    // Close modal when clicking outside the modal content
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Modal event listeners initialized');
        
        // Initialize Chapter Carousel
        initChapterCarousel();
        
        window.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                console.log('Clicked outside modal, closing');
                event.target.classList.remove('show');
                document.body.style.overflow = 'auto';
            }
        });

        // Attach event listeners for popup URL buttons
        document.querySelectorAll('[data-popup-url]').forEach(btn => {
            btn.addEventListener('click', () => {
                window.open(btn.dataset.popupUrl, '_blank', 'width=1000,height=800,menubar=no,toolbar=no');
            });
        });

        // Attach event listeners for modal open buttons
        document.querySelectorAll('[data-modal-target]').forEach(btn => {
            btn.addEventListener('click', () => openModal(btn.dataset.modalTarget));
        });

        // Attach event listeners for modal close buttons
        document.querySelectorAll('[data-modal-close]').forEach(btn => {
            btn.addEventListener('click', () => closeModal(btn.dataset.modalClose));
        });

        // Attach event listeners for navigation buttons
        document.querySelectorAll('[data-nav-url]').forEach(btn => {
            btn.addEventListener('click', () => {
                window.location.href = btn.dataset.navUrl;
            });
        });

        // Attach event listeners for chapter carousel prev/next
        const chPrev = document.getElementById('chapter-carousel-prev');
        const chNext = document.getElementById('chapter-carousel-next');
        if (chPrev) chPrev.addEventListener('click', chapterCarouselPrev);
        if (chNext) chNext.addEventListener('click', chapterCarouselNext);

        // Attach event listeners for chapter carousel dots
        document.querySelectorAll('.chapter-carousel-dot').forEach(dot => {
            dot.addEventListener('click', () => {
                chapterCarouselDot(parseInt(dot.dataset.dotIndex, 10));
            });
        });
    });
    
    // Chapter Carousel Functions
    let chapterCurrentSlide = 0;
    let chapterSlides, chapterDots;
    
    function initChapterCarousel() {
        chapterSlides = document.querySelectorAll('.chapter-carousel-slide');
        chapterDots = document.querySelectorAll('.chapter-carousel-dot');
        
        if (chapterSlides.length > 0) {
            chapterShowSlide(chapterCurrentSlide);
            // Auto-rotate carousel every 5 seconds
            setInterval(chapterCarouselNext, 5000);
        }
    }
    
    function chapterShowSlide(n) {
        if (!chapterSlides.length) return;
        
        if (n >= chapterSlides.length) chapterCurrentSlide = 0;
        if (n < 0) chapterCurrentSlide = chapterSlides.length - 1;
        
        chapterSlides.forEach(slide => slide.classList.remove('active'));
        chapterDots.forEach(dot => dot.classList.remove('active'));
        
        chapterSlides[chapterCurrentSlide].classList.add('active');
        if (chapterDots.length > 0) {
            chapterDots[chapterCurrentSlide].classList.add('active');
        }
    }
    
    function chapterCarouselNext() {
        chapterCurrentSlide++;
        chapterShowSlide(chapterCurrentSlide);
    }
    
    function chapterCarouselPrev() {
        chapterCurrentSlide--;
        chapterShowSlide(chapterCurrentSlide);
    }
    
    function chapterCarouselDot(n) {
        chapterCurrentSlide = n;
        chapterShowSlide(chapterCurrentSlide);
    }
</script>
{% endblock %}
